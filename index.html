<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CarCultureAi Tuning Atölyesi</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Roboto:wght@300;400&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Roboto', sans-serif;
            background-color: #111827; /* bg-gray-900 */
        }
        h1, #year-display {
            font-family: 'Orbitron', sans-serif;
        }
        .theme-accent-bg { background-color: #0d9488; } /* teal-600 */
        .theme-accent-gradient-text { background-image: linear-gradient(to right, #5eead4, #a7f3d0); } /* from-teal-300 to-emerald-300 */
        .theme-accent-gradient-button { background-image: linear-gradient(to bottom right, #14b8a6, #0d9488); } /* from-teal-500 to-teal-600 */
        .theme-accent-gradient-button:hover { background-image: linear-gradient(to bottom right, #0d9488, #0f766e); } /* from-teal-600 to-teal-700 */

        input[type="range"] {
            -webkit-appearance: none;
            appearance: none;
            width: 100%;
            height: 8px;
            background: #4b5563; /* bg-gray-600 */
            border-radius: 5px;
            outline: none;
            transition: all .2s;
        }
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 28px;
            height: 28px;
            background-color: #14b8a6; /* theme-accent */
            border: 4px solid #ffffff;
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 0 10px rgba(20, 184, 166, 0.7);
        }
        .emboss-card {
            background-color: #1f2937; /* bg-gray-800 */
            border-radius: 16px;
            box-shadow: inset 0 2px 4px 0 rgba(0, 0, 0, 0.2), 0 8px 16px rgba(0,0,0,0.4);
            border: 1px solid #4b5563;
        }
        .emboss-button {
            transition: all 0.2s ease-in-out;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.4), 0 2px 4px -2px rgba(0, 0, 0, 0.2);
        }
        .emboss-button:active:not(:disabled) {
            transform: translateY(2px);
            box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.3);
        }
        .emboss-button:disabled { cursor: not-allowed; opacity: 0.5; }
        .era-button.active {
            background-color: #14b8a6; /* theme-accent */
            color: white;
            box-shadow: 0 0 15px rgba(20, 184, 166, 0.6);
            transform: scale(1.05);
        }
        .loader {
            border: 8px solid #f3f3f320; border-top: 8px solid #14b8a6; /* theme-accent */
            border-radius: 50%; width: 80px; height: 80px; animation: spin 1s linear infinite;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        
        .custom-input {
            background-color: #374151;
            border: 1px solid #4b5563;
            color: white;
        }
        .custom-input:disabled {
            background-color: #4b5563;
            opacity: 0.5;
            cursor: not-allowed;
        }
        .lang-btn {
            cursor: pointer;
            padding: 4px;
            border-radius: 4px;
            transition: background-color 0.2s;
        }
        #language-dropdown button.active {
             background-color: #14b8a6; /* theme-accent */
        }
    </style>
</head>
<body class="bg-gray-900 text-white flex items-center justify-center min-h-screen p-4">

    <div class="w-full max-w-3xl mx-auto">
        <div class="relative flex justify-end items-center mb-4">
             <button id="current-lang-btn" class="flex items-center space-x-2 p-2 bg-gray-700 rounded-md">
                 <span id="current-lang-flag">🇹🇷</span>
                 <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
             </button>
             <div id="language-dropdown" class="absolute top-full right-0 mt-2 w-48 bg-gray-800 rounded-md shadow-lg hidden z-10">
                 </div>
        </div>

        <div class="flex flex-col items-center space-y-6">
             <img id="logo" src="https://yt3.googleusercontent.com/kC7hkLB3KfeqjY4svqE9EPIVEzzZRUenH9B0r8kFIf4B5kNVE5Azra2LPrU8So5NBEHhVvWtZ_8=s160-c-k-c0x00ffffff-no-rj" alt="CarCultureAi Logo" class="w-24 h-24 mx-auto rounded-full shadow-lg border-2 border-teal-400/50">
            <h1 id="main-title" data-translate="mainTitle" class="text-4xl md:text-5xl font-bold text-center tracking-wider bg-clip-text text-transparent theme-accent-gradient-text">
                CarCultureAi Tuning Atölyesi
            </h1>

            <div id="year-selection-area" class="w-full space-y-6">
                <div class="w-full bg-gray-800/50 backdrop-blur-sm p-4 rounded-2xl shadow-2xl border border-gray-700">
                    <h2 id="era-title" data-translate="eraTitle" class="text-center text-lg text-teal-300 font-semibold mb-3"></h2>
                    <div id="era-buttons" class="grid grid-cols-2 sm:grid-cols-4 gap-3">
                        <button data-era="antika" class="era-button bg-gray-700 hover:bg-gray-600 rounded-lg py-2 px-3">(1920-1949)</button>
                        <button data-era="klasik" class="era-button bg-gray-700 hover:bg-gray-600 rounded-lg py-2 px-3">(1950-1979)</button>
                        <button data-era="retro" class="era-button bg-gray-700 hover:bg-gray-600 rounded-lg py-2 px-3">(1980-1999)</button>
                        <button data-era="modern" class="era-button bg-gray-700 hover:bg-gray-600 rounded-lg py-2 px-3 active" id="modern-era-button">(2000-)</button>
                    </div>
                </div>

                <div class="w-full bg-gray-800/50 backdrop-blur-sm p-6 rounded-2xl shadow-2xl border border-gray-700">
                    <h2 id="year-title" data-translate="yearTitle" class="text-center text-lg text-teal-300 font-semibold mb-3"></h2>
                    <div id="year-display" class="text-4xl md:text-5xl font-bold text-center text-teal-400 mb-6"></div>
                    <input type="range" id="year-slider" class="w-full">
                    <div class="flex justify-between text-xs text-gray-400 mt-2 px-1">
                        <span id="slider-min-label"></span>
                        <span id="slider-max-label"></span>
                    </div>
                </div>
            </div>
            
            <div class="w-full bg-gray-800/50 backdrop-blur-sm p-4 rounded-2xl shadow-2xl border border-gray-700">
                <h2 id="custom-title" data-translate="customTitle" class="text-center text-lg text-teal-300 font-semibold mb-3"></h2>
                <div class="space-y-4">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label id="model-label" data-translate="modelLabel" for="car-model-input" class="block text-sm font-medium text-gray-300 mb-1"></label>
                            <input type="text" id="car-model-input" data-translate-placeholder="modelPlaceholder" class="custom-input w-full p-2 rounded-md">
                        </div>
                        <div>
                            <label id="livery-label" data-translate="liveryLabel" for="livery-select" class="block text-sm font-medium text-gray-300 mb-1"></label>
                            <select id="livery-select" class="custom-input w-full p-2 rounded-md">
                                <option id="livery-none" data-translate="liveryNone" value="none"></option>
                                <option id="livery-falken" data-translate="liveryFalken" value="falken"></option>
                                <option id="livery-monster" data-translate="liveryMonster" value="monster"></option>
                                <option id="livery-martini" data-translate="liveryMartini" value="martini"></option>
                                <option id="livery-gulf" data-translate="liveryGulf" value="gulf"></option>
                                <option id="livery-jagermeister" data-translate="liveryJagermeister" value="jagermeister"></option>
                                <option id="livery-castrol" data-translate="liveryCastrol" value="castrol"></option>
                            </select>
                        </div>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label id="mod-style-label" data-translate="modStyleLabel" for="mod-style-select" class="block text-sm font-medium text-gray-300 mb-1"></label>
                            <select id="mod-style-select" class="custom-input w-full p-2 rounded-md">
                                <option id="mod-style-stock" data-translate="modStyleStock" value="stock"></option>
                                <option id="mod-style-lbwk" data-translate="modStyleLbwk" value="lbwk"></option>
                                <option id="mod-style-pandem" data-translate="modStylePandem" value="pandem"></option>
                                <option id="mod-style-rwb" data-translate="modStyleRwb" value="rwb"></option>
                                <option id="mod-style-dtm" data-translate="modStyleDtm" value="dtm"></option>
                                <option id="mod-style-rally" data-translate="modStyleRally" value="rally"></option>
                                <option id="mod-style-madmax" data-translate="modStyleMadmax" value="madmax"></option>
                                <option id="mod-style-stancenation" data-translate="modStyleStancenation" value="stancenation"></option>
                                <option id="mod-style-silhouette" data-translate="modStyleSilhouette" value="silhouette"></option>
                                <option id="mod-style-drift" data-translate="modStyleDrift" value="drift"></option>
                                <option id="mod-style-bosozoku" data-translate="modStyleBosozoku" value="bosozoku"></option>
                                <option id="mod-style-vip" data-translate="modStyleVip" value="vip"></option>
                            </select>
                        </div>
                         <div>
                            <label id="car-type-label" data-translate="carTypeLabel" for="car-type-select" class="block text-sm font-medium text-gray-300 mb-1"></label>
                            <select id="car-type-select" class="custom-input w-full p-2 rounded-md">
                                <option id="car-type-default" data-translate="carTypeDefault" value="default"></option>
                                <option id="car-type-sedan" data-translate="carTypeSedan" value="sedan"></option>
                                <option id="car-type-suv" data-translate="carTypeSuv" value="suv"></option>
                                <option id="car-type-hatchback" data-translate="carTypeHatchback" value="hatchback"></option>
                                <option id="car-type-station_wagon" data-translate="carTypeStationWagon" value="station_wagon"></option>
                                <option id="car-type-minivan" data-translate="carTypeMinivan" value="minivan"></option>
                                <option id="car-type-pickup" data-translate="carTypePickup" value="pickup"></option>
                                <option id="car-type-cabrio" data-translate="carTypeCabrio" value="cabrio"></option>
                            </select>
                        </div>
                    </div>
                     <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label id="camera-angle-label" data-translate="cameraAngleLabel" for="camera-angle-select" class="block text-sm font-medium text-gray-300 mb-1"></label>
                            <select id="camera-angle-select" class="custom-input w-full p-2 rounded-md">
                                <option id="camera-angle-front_3_4" data-translate="cameraAngleFront34" value="front_3_4"></option>
                                <option id="camera-angle-rear_3_4" data-translate="cameraAngleRear34" value="rear_3_4"></option>
                                <option id="camera-angle-side" data-translate="cameraAngleSide" value="side_profile"></option>
                                <option id="camera-angle-low_front" data-translate="cameraAngleLowFront" value="low_front"></option>
                                <option id="camera-angle-low_rear" data-translate="cameraAngleLowRear" value="low_rear"></option>
                                <option id="camera-angle-high_front" data-translate="cameraAngleHighFront" value="high_front"></option>
                                <option id="camera-angle-high_rear" data-translate="cameraAngleHighRear" value="high_rear"></option>
                                <option id="camera-angle-rolling" data-translate="cameraAngleRolling" value="rolling_shot"></option>
                            </select>
                        </div>
                         <div>
                            <label id="scene-label" data-translate="sceneLabel" for="scene-select" class="block text-sm font-medium text-gray-300 mb-1"></label>
                            <select id="scene-select" class="custom-input w-full p-2 rounded-md">
                                <option id="scene-option-studio" data-translate="sceneOptionStudio" value="beyaz_studyo"></option>
                                <option id="scene-option-meet" data-translate="sceneOptionMeet" value="car_meet"></option>
                                <option id="scene-option-basketball" data-translate="sceneOptionBasketball" value="basketball_court"></option>
                            </select>
                        </div>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label id="time-label" data-translate="timeLabel" for="time-select" class="block text-sm font-medium text-gray-300 mb-1"></label>
                            <select id="time-select" class="custom-input w-full p-2 rounded-md">
                                <option id="time-option-morning" data-translate="timeOptionMorning" value="morning"></option>
                                <option id="time-option-noon" data-translate="timeOptionNoon" value="noon"></option>
                                <option id="time-option-sunset" data-translate="timeOptionSunset" value="sunset"></option>
                                <option id="time-option-night" data-translate="timeOptionNight" value="night"></option>
                            </select>
                        </div>
                        <div>
                            <label id="season-label" data-translate="seasonLabel" for="season-select" class="block text-sm font-medium text-gray-300 mb-1"></label>
                            <select id="season-select" class="custom-input w-full p-2 rounded-md">
                                <option id="season-option-spring" data-translate="seasonOptionSpring" value="spring"></option>
                                <option id="season-option-summer" data-translate="seasonOptionSummer" value="summer"></option>
                                <option id="season-option-autumn" data-translate="seasonOptionAutumn" value="autumn"></option>
                                <option id="season-option-winter" data-translate="seasonOptionWinter" value="winter"></option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>

            <button id="generate-button" data-translate="generateButton" class="emboss-button text-white font-bold py-3 px-8 rounded-full text-lg shadow-lg focus:outline-none focus:ring-4 focus:ring-teal-500/50 theme-accent-gradient-button"></button>

            <div id="result-card" class="w-full emboss-card p-6 hidden">
                <div id="loading-indicator" class="w-full flex justify-center items-center py-16 hidden"><div class="loader"></div></div>
                <div id="content-wrapper" class="hidden">
                    <div id="image-container" class="aspect-w-16 aspect-h-9 mb-6 relative bg-gray-900/50 rounded-lg mx-auto">
                        <img id="event-image" src="" alt="Modifiyeli araba görseli" class="w-full h-full object-contain rounded-lg shadow-md border-2 border-gray-600">
                    </div>
                    <h2 id="car-model" class="text-3xl font-bold text-teal-300 mb-3"></h2>
                    <p id="car-description" class="text-gray-300 text-lg leading-relaxed"></p>
                </div>
                <div id="error-message" class="text-center text-red-400 font-semibold hidden"></div>
            </div>
        </div>
    </div>

<script>
    // --- DOM Element References ---
    const yearSlider = document.getElementById('year-slider');
    const yearDisplay = document.getElementById('year-display');
    const generateButton = document.getElementById('generate-button');
    const resultCard = document.getElementById('result-card');
    const loadingIndicator = document.getElementById('loading-indicator');
    const contentWrapper = document.getElementById('content-wrapper');
    const eventImage = document.getElementById('event-image');
    const carModel = document.getElementById('car-model');
    const carDescription = document.getElementById('car-description');
    const errorMessage = document.getElementById('error-message');
    const eraButtonsContainer = document.getElementById('era-buttons');
    const sliderMinLabel = document.getElementById('slider-min-label');
    const sliderMaxLabel = document.getElementById('slider-max-label');
    const sceneSelect = document.getElementById('scene-select');
    const modStyleSelect = document.getElementById('mod-style-select');
    const liverySelect = document.getElementById('livery-select');
    const carTypeSelect = document.getElementById('car-type-select');
    const cameraAngleSelect = document.getElementById('camera-angle-select');
    const timeSelect = document.getElementById('time-select');
    const seasonSelect = document.getElementById('season-select');
    const carModelInput = document.getElementById('car-model-input');
    const modernEraButton = document.getElementById('modern-era-button');
    const currentLangBtn = document.getElementById('current-lang-btn');
    const currentLangFlag = document.getElementById('current-lang-flag');
    const languageDropdown = document.getElementById('language-dropdown');

    // --- Translation Data ---
    const languages = {
        tr: { name: "Türkçe", flag: "🇹🇷", dir: "ltr" },
        en: { name: "English", flag: "🇬🇧", dir: "ltr" },
        pt: { name: "Português", flag: "🇵🇹", dir: "ltr" },
        es: { name: "Español", flag: "🇪🇸", dir: "ltr" },
        de: { name: "Deutsch", flag: "🇩🇪", dir: "ltr" },
        fr: { name: "Français", flag: "🇫🇷", dir: "ltr" },
        it: { name: "Italiano", flag: "🇮🇹", dir: "ltr" },
        nl: { name: "Nederlands", flag: "🇳🇱", dir: "ltr" },
        ar: { name: "العربية", flag: "🇸🇦", dir: "rtl" },
        hi: { name: "हिन्दी", flag: "🇮🇳", dir: "ltr" },
        az: { name: "Azərbaycanca", flag: "🇦🇿", dir: "ltr" },
        ja: { name: "日本語", flag: "🇯🇵", dir: "ltr" },
        zh: { name: "中文", flag: "🇨🇳", dir: "ltr" },
        ko: { name: "한국어", flag: "🇰🇷", dir: "ltr" },
        sv: { name: "Svenska", flag: "🇸🇪", dir: "ltr" },
    };

    const translations = {
        mainTitle: { tr: "CarCultureAi Tuning Atölyesi", en: "CarCultureAi Tuning Workshop" },
        eraTitle: { tr: "1. Yıla Göre Rastgele Araç", en: "1. Random Car by Year" },
        yearTitle: { tr: "Yıl Seçin", en: "Select Year" },
        customTitle: { tr: "Atölye Seçenekleri", en: "Workshop Options" },
        modelLabel: { tr: "Araç Modeli ve Rengi (Yılı yukarıdan seçin)", en: "Car Model & Color (Select year above)" },
        modelPlaceholder: { tr: "Örn: Ferrari F40 Kırmızı veya sadece Mercedes", en: "e.g., Ferrari F40 Red or just Mercedes" },
        modStyleLabel: { tr: "Modifiye Tarzı", en: "Modification Style" },
        modStyleStock: { tr: "Stok (Fabrika Çıkışlı)", en: "Stock (Factory)" },
        modStyleStancenation: { tr: "StanceNation", en: "StanceNation" },
        modStyleSilhouette: { tr: "Silhouette", en: "Silhouette" },
        modStyleDrift: { tr: "Drift Tarzı", en: "Drift Style" },
        modStyleBosozoku: { tr: "Bosozoku", en: "Bosozoku" },
        modStyleVip: { tr: "VIP / Bippu", en: "VIP / Bippu" },
        modStyleLbwk: { tr: "Liberty Walk (LBWK)", en: "Liberty Walk (LBWK)" },
        modStylePandem: { tr: "Rocket Bunny / Pandem", en: "Rocket Bunny / Pandem" },
        modStyleRwb: { tr: "RWB", en: "RWB" },
        modStyleRally: { tr: "Ralli", en: "Rally" },
        modStyleDtm: { tr: "DTM", en: "DTM" },
        modStyleMadmax: { tr: "Mad Max", en: "Mad Max" },
        liveryLabel: { tr: "Kaplama / Dekal", en: "Livery / Decal" },
        liveryNone: { tr: "Dekalsız (Sade Boya)", en: "No Decals (Plain Paint)"},
        liveryFalken: { tr: "Falken", en: "Falken" },
        liveryMonster: { tr: "Monster Energy", en: "Monster Energy" },
        liveryMartini: { tr: "Martini Racing", en: "Martini Racing" },
        liveryGulf: { tr: "Gulf Oil", en: "Gulf Oil" },
        liveryJagermeister: { tr: "Jägermeister DTM", en: "Jägermeister DTM" },
        liveryCastrol: { tr: "Castrol TOM's Supra", en: "Castrol TOM's Supra" },
        carTypeLabel: { tr: "Araç Tipi", en: "Car Type" },
        carTypeDefault: { tr: "Standart", en: "Default" },
        carTypeSedan: { tr: "Sedan", en: "Sedan" },
        carTypeSuv: { tr: "SUV", en: "SUV" },
        carTypeHatchback: { tr: "Hatchback", en: "Hatchback" },
        carTypeStationWagon: { tr: "Station Wagon", en: "Station Wagon" },
        carTypeMinivan: { tr: "Minivan", en: "Minivan" },
        carTypePickup: { tr: "Pickup", en: "Pickup" },
        carTypeCabrio: { tr: "Cabrio", en: "Convertible" },
        cameraAngleLabel: { tr: "Kamera Açısı", en: "Camera Angle" },
        cameraAngleFront34: { tr: "Ön Çapraz", en: "Front 3/4" },
        cameraAngleRear34: { tr: "Arka Çapraz", en: "Rear 3/4" },
        cameraAngleSide: { tr: "Yan Profil", en: "Side Profile" },
        cameraAngleLowFront: { tr: "Ön Düşük Açı", en: "Low Angle Front" },
        cameraAngleLowRear: { tr: "Arka Düşük Açı", en: "Low Angle Rear" },
        cameraAngleHighFront: { tr: "Ön Yüksek Açı", en: "High Angle Front" },
        cameraAngleHighRear: { tr: "Arka Yüksek Açı", en: "High Angle Rear" },
        cameraAngleRolling: { tr: "Takip Çekimi", en: "Rolling Shot" },
        sceneLabel: { tr: "Sahne", en: "Scene" },
        sceneOptionStudio: { tr: "Beyaz Stüdyo", en: "White Studio" },
        sceneOptionMeet: { tr: "Araba Buluşması", en: "Car Meet" },
        sceneOptionBasketball: { tr: "Basketbol Sahası", en: "Basketball Court" },
        timeLabel: { tr: "Zaman Dilimi", en: "Time of Day" },
        timeOptionMorning: { tr: "Sabah", en: "Morning" },
        timeOptionNoon: { tr: "Öğle", en: "Noon" },
        timeOptionSunset: { tr: "Gün Batımı", en: "Sunset" },
        timeOptionNight: { tr: "Gece", en: "Night" },
        seasonLabel: { tr: "Mevsim", en: "Season" },
        seasonOptionSpring: { tr: "İlkbahar", en: "Spring" },
        seasonOptionSummer: { tr: "Yaz", en: "Summer" },
        seasonOptionAutumn: { tr: "Sonbahar", en: "Autumn" },
        seasonOptionWinter: { tr: "Kış", en: "Winter" },
        generateButton: { tr: "Arabayı Üret", en: "Generate Car" },
        descYear: { tr: "Üretim Yılı", en: "Production Year" },
        descCustom: { tr: "Özel Konsept", en: "Custom Concept" },
        errorGeneral: { tr: "Bir hata oluştu.", en: "An error occurred." },
        errorImage: { tr: "Görsel yüklenemedi.", en: "Could not load the image." },
        errorGemini: { tr: "Geçerli metin alınamadı.", en: "Could not get a valid text." },
        errorImagen: { tr: "Görsel üretilemedi.", en: "Image could not be generated." },
        errorParse: { tr: "Model anlaşılamadı.", en: "Could not understand model." }
    };
    
    // --- State Variables ---
    let currentLanguage = 'tr';
    const currentRealYear = new Date().getFullYear();
    const eras = {
        antika: { min: 1920, max: 1949, step: 1, default: 1932 },
        klasik: { min: 1950, max: 1979, step: 1, default: 1969 },
        retro: { min: 1980, max: 1999, step: 1, default: 1998 },
        modern: { min: 2000, max: currentRealYear, step: 1, default: currentRealYear }
    };

    // --- UI Functions ---
    const updateConditionalInputs = () => {
        const isStudio = sceneSelect.value === 'beyaz_studyo';
        timeSelect.disabled = isStudio;
        seasonSelect.disabled = isStudio;
    };

    const setLanguage = (lang) => {
        if (!languages[lang]) return;
        currentLanguage = lang;
        const langData = languages[lang];
        document.documentElement.lang = lang;
        document.documentElement.dir = langData.dir;
        currentLangFlag.textContent = langData.flag;
        languageDropdown.classList.add('hidden');
        Object.keys(translations).forEach(key => {
            const elements = document.querySelectorAll(`[data-translate="${key}"], [data-translate-placeholder="${key}"]`);
            elements.forEach(el => {
                const translation = translations[key][lang] || translations[key]['en'];
                if (el.hasAttribute('data-translate-placeholder')) {
                    el.placeholder = translation;
                } else if (el.hasAttribute('data-translate')) {
                    el.textContent = translation;
                }
            });
        });
    };

    const populateLanguageDropdown = () => {
        languageDropdown.innerHTML = '';
        for (const [code, lang] of Object.entries(languages)) {
            const button = document.createElement('button');
            button.className = 'w-full text-left px-4 py-2 text-sm text-white hover:bg-gray-700 flex items-center space-x-2';
            button.onclick = () => setLanguage(code);
            button.innerHTML = `<span>${lang.flag}</span><span>${lang.name}</span>`;
            languageDropdown.appendChild(button);
        }
    };

    const setEra = (eraName) => {
        const era = eras[eraName];
        yearSlider.min = era.min;
        yearSlider.max = era.max;
        yearSlider.step = era.step;
        yearSlider.value = era.default;
        sliderMinLabel.textContent = era.min.toString();
        sliderMaxLabel.textContent = era.max.toString();
        yearDisplay.textContent = era.default.toString();
        document.querySelectorAll('.era-button').forEach(btn => {
            btn.classList.toggle('active', btn.dataset.era === eraName);
        });
    };

    // --- Event Listeners ---
    yearSlider.addEventListener('input', () => { yearDisplay.textContent = parseInt(yearSlider.value).toString(); });
    eraButtonsContainer.addEventListener('click', (e) => { if (e.target.tagName === 'BUTTON') setEra(e.target.dataset.era); });
    sceneSelect.addEventListener('change', updateConditionalInputs);
    generateButton.addEventListener('click', handleMainGeneration);
    currentLangBtn.addEventListener('click', () => { languageDropdown.classList.toggle('hidden'); });
    document.addEventListener('click', (e) => {
        if (!currentLangBtn.contains(e.target) && !languageDropdown.contains(e.target)) {
            languageDropdown.classList.add('hidden');
        }
    });

    // --- Main Generation Logic ---
    async function handleMainGeneration() {
        try {
            const userInput = carModelInput.value.trim();
            const selectedYear = parseInt(yearSlider.value);
            const selectedModStyle = modStyleSelect.value;
            const selectedCarType = carTypeSelect.value;
            const selectedCameraAngle = cameraAngleSelect.value;
            const selectedScene = sceneSelect.value;
            const selectedTime = timeSelect.value;
            const selectedSeason = seasonSelect.value;
            const selectedLivery = liverySelect.value;
            showMainLoader(true);
            resetUI();
            let carNameText, selectedColor, descriptionText;
            if (userInput) {
                const parsed = await callGeminiForParsing(userInput, selectedYear);
                let finalModel = parsed.model;
                if (!/\d{4}/.test(finalModel)) {
                    finalModel = `${selectedYear} ${finalModel}`;
                }
                carNameText = finalModel;
                selectedColor = parsed.color;
                descriptionText = translations.descCustom[currentLanguage];
            } else {
                carNameText = await callGeminiForCar(selectedYear);
                descriptionText = `${translations.descYear[currentLanguage]}: ${selectedYear}`;
            }
            if (!selectedColor) {
                selectedColor = await callGeminiForColor();
            }
            const imageUrl = await callImagen(carNameText, selectedModStyle, selectedCarType, selectedCameraAngle, selectedScene, selectedTime, selectedSeason, selectedColor, selectedLivery);
            updateUIWithResults(carNameText, descriptionText, imageUrl);
        } catch (error) {
            handleError(error, error.message || translations.errorGeneral[currentLanguage]);
        } finally {
            showMainLoader(false);
        }
    }

    // --- API Call Functions ---
    const GEMINI_API_KEY = "AIzaSyAb6LNp7M_m5ug7cH2iGDFDhwqHRe3qfaU";
    const HUGGING_FACE_TOKEN = "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";

    async function callGemini(prompt, isJson = false) {
        if (!GEMINI_API_KEY) { throw new Error("Gemini API anahtarı eksik."); }
        const payload = { contents: [{ role: "user", parts: [{ text: prompt }] }] };
        if (isJson) { payload.generationConfig = { responseMimeType: "application/json" }; }
        const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash-latest:generateContent?key=${GEMINI_API_KEY}`;
        const response = await fetch(apiUrl, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) });
        if (!response.ok) {
            const errorBody = await response.text();
            console.error("Gemini API Error Body:", errorBody);
            throw new Error(`Gemini API Hatası: ${response.statusText}`);
        }
        const result = await response.json();
        if (result.candidates && result.candidates[0]?.content?.parts[0]?.text) {
            return result.candidates[0].content.parts[0].text.trim();
        }
        console.error("Gemini API - No content in response:", result);
        throw new Error(translations.errorGemini[currentLanguage]);
    }

    function callGeminiForCar(year) {
        const prompt = `Lütfen ${year} yılından ikonik, popüler veya yaygın olarak bilinen bir binek araba modeli adı ver. Sürekli aynı ünlü spor arabaları tekrarlamaktan kaçın. Daha fazla çeşitlilik göster (örneğin normal sedanlar, aile arabaları da olabilir). Cevabın sadece arabanın tam adı olsun (Örnek: 1985 Volkswagen Golf, 1992 Ford Taurus, 1969 Chevrolet Camaro). Başka hiçbir açıklama ekleme.`;
        return callGemini(prompt);
    }

    async function callGeminiForParsing(userInput, year) {
        const prompt = `Kullanıcının şu girdisini analiz et: "${userInput}". Eğer girdi sadece bir marka adıysa (örn: "Mercedes"), o markanın ${year} yılına ait ikonik bir modelini bul (örn: "Mercedes-Benz 190E"). Eğer girdi tam bir model adı içeriyorsa (örn: "Ferrari F40 Kırmızı"), o modeli kullan. Ayrıca girdideki rengi de çıkar. Sadece JSON formatında cevap ver: {"model": "...", "color": "..."}. Başka hiçbir metin veya markdown formatı ekleme.`;
        const jsonString = await callGemini(prompt, true);
        try { return JSON.parse(jsonString); } catch (e) {
            console.error("Failed to parse JSON from Gemini:", jsonString, e);
            throw new Error(translations.errorParse[currentLanguage]);
        }
    }

    function callGeminiForColor() {
        const prompt = `Suggest a single, exciting, and creative car color name. For example: 'Inferno Orange', 'Cosmic Blue', 'Stealth Black'. Only return the color name itself, with no extra text.`;
        return callGemini(prompt);
    }

    async function callImagen(carName, modStyle, carType, cameraAngle, scene, time, season, color, livery) {
        if (!HUGGING_FACE_TOKEN) { throw new Error("Hugging Face Token eksik."); }
        const promptParts = {
            camera: { front_3_4: 'A dynamic low-angle three-quarter front view shot of a', rear_3_4: 'A dynamic low-angle three-quarter rear view shot of a', side_profile: 'A clean, full side profile shot of a', low_front: 'An extreme low-angle three-quarter front view shot of a', low_rear: 'An extreme low-angle three-quarter rear view shot of a', high_front: 'A high-angle three-quarter front view shot looking down on a', high_rear: 'A high-angle three-quarter rear view shot looking down on a', rolling_shot: 'A dynamic rolling shot, capturing the motion of a' },
            carType: { default: '', sedan: 'reimagined as a 4-door sedan,', suv: 'reimagined as a sporty SUV,', hatchback: 'reimagined as an aggressive 3-door hot-hatch,', station_wagon: "reimagined as a sleek 'Shooting Brake' with an extended roofline,", minivan: 'reimagined as a heavily modified JDM-style minivan,', pickup: 'completely converted into a custom sport pickup truck, with the rear passenger area replaced by a functional truck bed,', cabrio: 'reimagined as a 2-door convertible with the top down,' },
            modStyle: { stock: 'in perfect, factory-stock condition. All parts are original, with a showroom finish, and no aftermarket modifications.', stancenation: `modified for the 'StanceNation' aesthetic, with an impossibly extreme negative camber ('oni-kyan' style). The car is slammed on air suspension to the point where the body rests on the ground. The fitment is the main focus.`, silhouette: `radically transformed into a Group 5 'silhouette' formula race car. The body is an unrecognizable, extremely wide, boxy shape with massive aerodynamic elements, a huge front spoiler, and a gigantic rear wing.`, drift: `reimagined as a professional drift competition car. It has a high-angle steering kit, a massive GT wing for downforce, and vented fenders.`, bosozoku: `radically transformed with an exaggerated 'Bosozoku' aesthetic. It features a massive, extended front spoiler ('deppa'), extremely long, upward-facing exhaust pipes ('takeyari'), and boxy fender flares.`, vip: `modified in the Japanese 'VIP' or 'Bippu' style. The focus is on clean luxury and an imposing stance. It's slammed on air suspension, features large, multi-piece, highly polished deep-dish wheels, and a subtle, clean body kit.`, lbwk: `modified with an extremely aggressive, authentic Liberty Walk (LBWK) wide-body aesthetic. It features signature LBWK massively oversized, bolted-on super-wide fender flares, an aggressive front splitter, deep side skirts, and a large GT wing.`, pandem: `modified with an authentic Pandem/Rocket Bunny wide-body aesthetic, known for its raw, race-inspired look. It features signature bolted-on super-wide fender flares with exposed hardware, a deep front lip spoiler, and a distinctive "swan neck" GT wing.`, rwb: `reimagined with the iconic RAUH-Welt BEGRIFF (RWB) aesthetic. It has extremely wide, riveted fender flares, a massive "champion" GT wing, and deep-dish Work Meister wheels.`, rally: `converted into a full-spec rally car. It features a lifted suspension, gravel tires, a prominent roof scoop, and a hood-mounted light pod.`, dtm: `converted with the aesthetic of a modern DTM touring car. It has an extremely boxy and aggressive wide-body kit, a massive front air dam, and a large adjustable rear wing.`, madmax: `converted for a post-apocalyptic world. The car is covered in scrap metal armor, rusty panels, and spikes. It has a massive supercharger sticking out of the hood, barred windows, and mismatched, rugged wheels.` },
            livery: { none: ``, falken: `The car's body is covered in the iconic Falken Tire livery, with its signature teal and blue scallops and logos.`, monster: `The car is wrapped in a matte black Monster Energy livery, featuring the massive green claw mark logo prominently.`, martini: `The car is adorned with the classic Martini Racing livery, featuring the dark blue, light blue, and red stripes over a white or silver body.`, gulf: `The car is painted in the legendary Gulf Oil livery, with its powder blue body and a central orange stripe.`, jagermeister: `The car is covered in the iconic bright orange Jägermeister DTM livery with its stag logo.`, castrol: `The car features the unforgettable green and red Castrol TOM's Supra livery.` },
            scene: { beyaz_studyo: `showcased in a vibrant, sterile white studio with a clean, seamless backdrop. The scene is illuminated by professional, mixed studio lighting.`, car_meet: `showcased at a vibrant car meet. The car is parked under mixed lighting, surrounded by the blurred motion of enthusiasts and other modified cars.`, basketball_court: `parked near a chain-link fence bordering a brightly lit urban basketball court. The shot is captured on classic photographic film, introducing realistic imperfections like subtle lens flares and film grain.` },
            time: { morning: 'The lighting is the soft, golden light of early morning.', noon: 'The scene is lit by the bright, direct light of midday.', sunset: 'The scene is bathed in the warm, orange glow of a sunset.', night: 'The scene is at night, with dramatic, moody lighting.' },
            season: { spring: 'The environment shows hints of spring, like fresh greenery.', summer: 'The atmosphere is that of a clear, bright summer day.', autumn: 'The ground is covered with colorful fallen autumn leaves.', winter: 'The scene is in winter, with a visible layer of snow on the ground and a cold atmosphere.' },
            common: `The car has an exceptionally slammed stance (unless rally or offroad mod style is selected). It sits on ultra-wide, deep-dish aftermarket wheels with stretched tires and exaggerated negative camber. The windows are tinted dark. Painted in a striking ${color}. The final image must be an energetic, cinematic, and bold, ultra-detailed photorealistic 4K resolution shot.`
        };
        let carBodyDescription = (carType === 'default' || modStyle === 'stock') ? '' : promptParts.carType[carType];
        let finalImagePrompt = `${promptParts.camera[cameraAngle]} ${carName}, ${carBodyDescription} ${promptParts.modStyle[modStyle]} ${promptParts.livery[livery]} The car is ${promptParts.scene[scene]}`;
        if (scene !== 'beyaz_studyo') {
            finalImagePrompt += ` ${promptParts.season[season]} ${promptParts.time[time]}`;
        }
        finalImagePrompt += ` ${promptParts.common}`;
        const API_URL = "https://api-inference.huggingface.co/models/stabilityai/stable-diffusion-xl-base-1.0";
        const payload = { inputs: finalImagePrompt };
        const response = await fetch(API_URL, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${HUGGING_FACE_TOKEN}` },
            body: JSON.stringify(payload)
        });
        if (!response.ok) {
            const errorBody = await response.text();
            console.error("Hugging Face API Error Response:", errorBody);
            if (errorBody.includes("is currently loading")) {
                 throw new Error("Model şu an yükleniyor, lütfen 20 saniye sonra tekrar deneyin.");
            }
            throw new Error(`Hugging Face API Hatası: ${response.statusText}`);
        }
        const imageBlob = await response.blob();
        const imageUrl = URL.createObjectURL(imageBlob);
        return imageUrl;
    }

    // --- UI Update and Helper Functions ---
    function resetUI() {
        resultCard.classList.remove('hidden');
        contentWrapper.classList.add('hidden');
        errorMessage.classList.add('hidden');
    }

    function showMainLoader(show) {
        loadingIndicator.classList.toggle('hidden', !show);
        generateButton.disabled = show;
    }

    function updateUIWithResults(modelText, descriptionText, imageUrl) {
        carModel.textContent = modelText;
        carDescription.textContent = descriptionText;
        eventImage.src = imageUrl;
        eventImage.onload = () => { contentWrapper.classList.remove('hidden'); };
        eventImage.onerror = () => handleError(new Error(translations.errorImage[currentLanguage]), translations.errorImage[currentLanguage]);
    }

    function handleError(error, message) {
        console.error(message, error);
        contentWrapper.classList.add('hidden');
        showMainLoader(false);
        errorMessage.textContent = error.message || `${message} Lütfen tekrar deneyin.`;
        errorMessage.classList.remove('hidden');
    }

    // --- Initialize ---
    window.onload = () => {
        try {
            modernEraButton.textContent = `(2000-${currentRealYear})`;
            setEra('modern');
            populateLanguageDropdown();
            setLanguage('tr');
            updateConditionalInputs();
        } catch(e) {
            console.error("Kritik başlatma hatası:", e);
            document.body.innerHTML = `<div class="text-red-500 text-center p-8">Uygulama başlatılırken kritik bir hata oluştu. Lütfen konsolu kontrol edin.</div>`;
        }
    };
</script>
</body>
</html>
